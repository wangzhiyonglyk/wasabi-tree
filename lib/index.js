!function(e,n){"object"==typeof exports&&"object"==typeof module?module.exports=n(require("prop-types"),require("react"),require("wasabi-api")):"function"==typeof define&&define.amd?define(["prop-types","react","wasabi-api"],n):"object"==typeof exports?exports["wasabi-tree"]=n(require("prop-types"),require("react"),require("wasabi-api")):e["wasabi-tree"]=n(e["prop-types"],e.react,e["wasabi-api"])}(self,(function(e,n,t){return(()=>{"use strict";var r={99:n=>{n.exports=e},156:e=>{e.exports=n},313:e=>{e.exports=t}},o={};function l(e){var n=o[e];if(void 0!==n)return n.exports;var t=o[e]={exports:{}};return r[e](t,t.exports,l),t.exports}l.n=e=>{var n=e&&e.__esModule?()=>e.default:()=>e;return l.d(n,{a:n}),n},l.d=(e,n)=>{for(var t in n)l.o(n,t)&&!l.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:n[t]})},l.o=(e,n)=>Object.prototype.hasOwnProperty.call(e,n),l.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var i={};return(()=>{function e(){return e=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},e.apply(this,arguments)}l.r(i),l.d(i,{default:()=>be});var n=l(156),t=l.n(n);function r(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}function o(e,n){if(e){if("string"==typeof e)return r(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?r(e,n):void 0}}function c(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var r,o,l=[],a=!0,i=!1;try{for(t=t.call(e);!(a=(r=t.next()).done)&&(l.push(r.value),!n||l.length!==n);a=!0);}catch(e){i=!0,o=e}finally{try{a||null==t.return||t.return()}finally{if(i)throw o}}return l}}(e,n)||o(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function d(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}var u=l(99),s=l.n(u);function f(e){return f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},f(e)}function h(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function p(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?h(Object(t),!0).forEach((function(n){d(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):h(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function y(e){var n;if("object"===f(e))if(null===e)n=null;else if(e instanceof Array){n=[];for(var t=0;t<e.length;t++)n.push(y(e[t]))}else if(e instanceof Date)n=new Date(e.valueOf());else if(e instanceof Map)n=new Map(e);else if(e instanceof Set)n=new Set(e);else for(var r in n={},e)n[r]=y(e[r]);else n=e;return n}function g(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"data";if("object"!==f(e)||Array.isArray(e))return e;var t=new Array,r=e;n.indexOf(".")>-1?t=n.split("."):t.push(n);var o=0;try{for(;o<t.length;){if(null==(r=r[t[o]]))return null;o++}}catch(e){return null}return r}function v(){for(var e=[],n="0123456789abcdef",t=0;t<36;t++)e[t]=n.substr(Math.floor(16*Math.random()),1);return e[14]="4",e[19]=n.substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]="-",e.join("")}function b(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,t=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(e===n)return!1;if(Object.prototype.toString.call(e)!==Object.prototype.toString.call(n))return!0;if("function"==typeof e)return e.toString()!==n.toString();if("object"!==f(e))return e!==n;try{if(Object.prototype.toString.call(e).indexOf("Map")>-1||Object.prototype.toString.call(e).indexOf("Set")>-1)return e!==n;var r=Object.getOwnPropertyNames(e),o=Object.getOwnPropertyNames(n);if(r.length!==o.length)return!0;for(var l=0;l<r.length;l++){var a=r[l],i=e[a],c=n[a];if(t){if(b(i,c,t))return!0}else{if("function"==typeof i&&i.toString()!==c.toString())return!0;if(i!==c)return!0}}}catch(t){console.log(e,n)}return!1}function m(e){for(var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"id",t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"pId",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"text",o=[],l={},a=0,i="",c="",d=0;d<e.length;d++){var u;c+=","+(null!==(u=e[d][n])&&void 0!==u?u:"")+","}for(var s=0;s<e.length;s++){var f,h;c.indexOf(","+(null!==(f=e[s][t])&&void 0!==f?f:"")+",")<=-1&&(i+=","+(null!==(h=e[s][t])&&void 0!==h?h:"")+",")}for(var y=0;0!==e.length&&a<2e6;){var g,v;if(a++,i.indexOf(","+(null!==(g=e[y][t])&&void 0!==g?g:"")+",")>-1||null===(v=e[y][t])||void 0===v||!v){var b,m,k=p(p({},e[y]),{},{id:null!==(b=e[y][n])&&void 0!==b?b:"",pId:null!==(m=e[y][t])&&void 0!==m?m:"",text:e[y][r],children:[]});o.push(k),l[e[y][n]]=[o.length-1],k._path=[o.length-1],e.splice(y,1),y--}else{var w,x=l[null!==(w=e[y][t])&&void 0!==w?w:""];if(x){for(var O,C,D=o[x[0]],E=1;E<x.length;E++)D=D.children[x[E]];var I=p(p({},e[y]),{},{id:e[y][n],pId:null!==(O=e[y][t])&&void 0!==O?O:"",text:e[y][r],children:null!==(C=e[y].children)&&void 0!==C?C:[]});D.children.push(I),l[e[y][n]]=x.concat([D.children.length-1]),I._path=l[e[y][n]],e.splice(y,1),y--}}++y>e.length-1&&(y=0)}return e.length>0&&console.error("数据格式不正确，或者是数据量过大，请使用异步请求"),o}function k(e){var n=[];if(e&&e instanceof Array)for(var t=0;t<e.length;t++)e[t]._isLast=t===e.length-1,n.push(e[t]),e[t].children&&e[t].children.length>0&&!0===e[t].open&&(n=n.concat(k(e[t].children)));return n}function w(e){return function(e){if(Array.isArray(e))return r(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||o(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}const x=function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"id",l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"pId",a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"text",i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"children",c=arguments.length>7?arguments[7]:void 0,d=[];return Array.isArray(n)&&(d=(n=c?m(n,o,l,a):n).map((function(n,c){return n.id=n[o],n.pId=t,n._path=[].concat(w(r),[c]),n.text=n[a],n.children=Array.isArray(n[i])&&n[i].length>0?e(n[i],n[o],[].concat(w(r),[c]),o,l,a,i,!1):[],n}))),d};function O(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function C(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?O(Object(t),!0).forEach((function(n){d(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):O(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function D(e,n){var t;if(e&&e.length>0&&null!=n&&""!==n)for(var r=0;r<e.length;r++){if(e[r].id===n)return e[r];if(e[r].children&&e[r].children instanceof Array&&e[r].children.length>0&&(t=D(e[r].children,n)))return t}return t}function E(e,n){var t;if(e&&e.length>0&&n&&n.length>0&&(t=e[n[0]],n&&n.length>1))for(var r=1;r<n.length;r++)t.children&&t.children.length>0&&(t=t.children[n[r]]);return t}function I(e,n){var t=[];if(e&&e.length>0&&n&&n.length>0&&(t=[e[n[0]]],n&&n.length>1))for(var r=1;r<n.length;r++)t[t.length-1].children&&t[t.length-1].children.length>0&&t.push(t[t.length-1].children[n[r]]);return t}function S(e,n,t,r){try{var o=I(e,n._path);if(o&&o.length>0){var l=o[o.length-1];l.checked=!!t,(t&&r&&r.y&&r.y.indexOf("s")>-1||!t&&r&&r.n&&r.n.indexOf("s")>-1)&&(l=A(l,l.checked)),(l.checked&&r&&r.y&&r.y.indexOf("p")>-1||!l.checked&&r&&r.n&&r.n.indexOf("p")>-1)&&function(e){if(e&&e.length>1)for(var n=e.length-2;n>=0;n--)if(e[n].children&&e[n].children.length>0){for(var t=0,r=0,o=0;o<e[n].children.length;o++)e[n].children[o].checked&&t++,e[n].children[o].half&&r++;t===e[n].children.length?(e[n].checked=!0,e[n].half=!1):t>0&&t!==e[n].children.length||r>0?(e[n].checked=!1,e[n].half=!0):(e[n].checked=!1,e[n].half=!1)}}(o)}}catch(e){console.log("setChecked",e)}return e}function j(e,n,t,r){try{if("all"==r){var o,l=E(e=N(e),null!==(o=l._path)&&void 0!==o?o:D(l.id)._path);l.checked=t,l.half=!1}else if("level"==r){var a,i=I(e,n._path?n._path:null===(a=D(n.id))||void 0===a?void 0:a._path);if(i&&i.length>=2){var c=i[i.length-2];if(c.children&&c.children.length>0)for(var d=0;d<c.children.length;d++)c.children[d].checked=!1,c.children[d].half=!1}else if(i&&1==i.length)for(var u=0;u<e.length;u++)e[u].checked=!1,e[u].half=!1;i&&i.length>0&&(i[i.length-1].checked=t,i[i.length-1].half=!1)}}catch(e){console.log(e)}return e}function A(e,n){if(e.checked=n,e.half=!1,e.children&&e.children.length>0)for(var t=0;t<e.children.length;t++)e.children[t]=A(e.children[t],n);return e}function R(e){var n=[];if(e&&e instanceof Array&&e.length>0)for(var t=0;t<e.length;t++)e[t].checked&&n.push(e[t]),e[t].children&&e[t].children.length>0&&(n=[].concat(n,R(e[t].children)));return n}function N(e){if(e&&e instanceof Array&&e.length>0){for(var n=0;n<e.length;n++)e[n].checked=!1,e[n].half=!1,e[n].children&&e[n].children.length>0&&(e[n].children=N(e[n].children));return e}}function _(e){if(e&&e instanceof Array&&e.length>0){for(var n=0;n<e.length;n++)e[n].checked=!0,e[n].half=!1,e[n].children&&e[n].children.length>0&&(e[n].children=_(e[n].children));return e}}function T(e,n){var t,r=I(e,null!==(t=n._path)&&void 0!==t?t:D(n.id)._path);if(1==r.length)try{return e.splice(r[0]._path[0],1),B("",[],e)}catch(e){console.log("removeNode",r)}else{var o=r[r.length-2];o.children.splice(n._path[n._path.length-1],1),o.children=B(o.id,o._path,o.children)}return e}function P(e,n,t){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;try{var o=I(e,n._path),l=I(e,t._path);if(o&&l){var a=o[o.length-1],i=l[l.length-1];if(1==l.length)e=B("",[],e=[].concat(w(e.slice(0,i._path[0]+r)),[C(C({},a),{},{pId:"",_path:i._path})],w(e.slice(i._path[0]+r,e.length))));else{var c=l[l.length-2];c.children=[].concat(w(c.children.slice(0,i._path[0]+r)),[C(C({},a),{},{pId:i.pId,_path:i._path})],w(c.children.slice(i._path[0]+r,c.children.length))),c.children=B(c.id,c._path,c.children)}e=T(e,a)}}catch(e){}return e}function B(e,n,t){if(t&&t.length>0){for(var r=0;r<t.length;r++){try{t[r]._path=[].concat(w(n),[r])}catch(e){console.log("setChildrenPath",r,t,t[r])}t[r].pId=e,t[r].children&&t[r].children.length>0&&(t[r].children=B(t[r].id,[].concat(w(n),[r]),t[r].children))}return t}return[]}function F(e){var n,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=[];t=(null!==(n=t)&&void 0!==n?n:"").toString().trim();try{if(t)for(var o=0;o<e.length;o++){var l=null;((e[o].id+"").indexOf(key)>-1||(e[o].text+"").indexOf(key)>-1)&&((l=e[o]).open=!0,r.push(l))}}catch(e){}return[]}var V=l(313),U=l.n(V);const H=30,M=function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=[];if(t&&t instanceof Array&&t.length>0)for(var o=0;o<t.length;o++)if((","+n+",").indexOf(","+(t[o].value+""||t[o].id+"")+",")>-1&&r.push(t[o].text),t[o].children&&t[o].children.length>0){var l=e(n,t[o].children);r=[].concat(l,r)}return r||[]};function q(e,r){var o=this,l=c((0,n.useState)(e.value),2),a=l[0],i=l[1],d=(0,n.useMemo)((function(){return M(a,e.data).join(",")}),[e.data,a]);(0,n.useEffect)((function(){var n;i((null!==(n=e.value)&&void 0!==n?n:"")+"")}),[e.value]),(0,n.useImperativeHandle)(r,(function(){return{setValue:function(e){i(e)},getValue:function(){return a}}}));var u=e.data,s=e.half,f=e.readOnly,h=(0,n.useCallback)((function(n,t,r,o,l){if(!e.readOnly)if(""!==n){var a=o.toString()||"",c=l||"";if(a=a?a.split(","):[],c=c?c.split(","):[],a.indexOf(n.toString())>-1)try{a.splice(a.indexOf(n.toString()),1),c.splice(c.indexOf(t.toString()),1)}catch(e){}else a.push(n+""),c.push(t+"");i(a.join(",")),e.onSelect&&e.onSelect(a.join(","),c.join(","),e.name,r)}else i(""),e.onSelect&&e.onSelect("","",e.name,r)}),[]);return u&&u instanceof Array&&u.length>0?t().createElement("div",{className:"wasabi-form-group "+(e.className||"")},t().createElement("div",{className:"wasabi-form-group-body"+(e.readOnly||e.disabled?" readOnly":"")},t().createElement("ul",{className:"wasabi-checkul radio"},u.map((function(e,n){var r,l,i=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",t=!1;return n&&(","+n.toString()+",").indexOf(","+e.value+",")>-1&&(t=!0),t}(e,a);return t().createElement("li",{key:n,onClick:h.bind(o,null!==(r=e.value)&&void 0!==r?r:"",null!==(l=e.text)&&void 0!==l?l:"",e,a,d)},t().createElement("label",{className:"checkbox-label "+(i?" checked ":" ")+(s?" halfcheck ":""),readOnly:f}),t().createElement("div",{className:"checktext "+(i?" checked":""),readOnly:f},e.text))}))))):null}const L=t().memo(t().forwardRef(q),(function(e,n){return b(e,n)}));function J(e,r){var o=this,l=c((0,n.useState)(e.value),2),a=l[0],i=l[1];(0,n.useEffect)((function(){i(e.value)}),[e.value]);var d=(0,n.useCallback)((function(n,t,r){i(n),e.onSelect&&e.onSelect(n,t,r)}),[]);(0,n.useImperativeHandle)(r,(function(){return{setValue:function(e){i(e)},getValue:function(){return a}}}));var u=e.data,s=e.readOnly;if(u&&u instanceof Array&&u.length>0){var f="wasabi-radio-btn "+(s?" readOnly":"");return t().createElement("div",{className:"wasabi-form-group "+(e.className||"")},t().createElement("div",{className:"wasabi-form-group-body"+(e.readOnly||e.disabled?" readOnly":"")},t().createElement("ul",{className:"wasabi-checkul radio"},u.map((function(e,n){var r,l;return t().createElement("li",{key:n},t().createElement("div",{className:f+((null!=a?a:"")+""==(null!==(r=e.value)&&void 0!==r?r:"")+""?" checkedRadio":""),onClick:d.bind(o,e.value,e.text,e)},t().createElement("i",null)),t().createElement("div",{className:"radiotext "+(s?" readOnly":"")+((null!=a?a:"")+""==(null!==(l=e.value)&&void 0!==l?l:"")+""?" checkedRadio":""),onClick:d.bind(o,e.value,e.text,e)},e.text))})))))}return null}const K=t().memo(t().forwardRef(J),(function(e,n){return!b(e,n)}));function G(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function Y(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function $(e,n,t){return n&&Y(e.prototype,n),t&&Y(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function z(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Q(e,n){return Q=Object.setPrototypeOf||function(e,n){return e.__proto__=n,e},Q(e,n)}function W(e,n){if(n&&("object"===f(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");return z(e)}function X(e){return X=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},X(e)}const Z=function(e){!function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),n&&Q(e,n)}(l,e);var n,r,o=(n=l,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=X(n);if(r){var o=X(this).constructor;e=Reflect.construct(t,arguments,o)}else e=t.apply(this,arguments);return W(this,e)});function l(e){var n;return G(this,l),(n=o.call(this,e)).state={oldPropsValue:null,value:n.props.value||""},n.onChange=n.onChange.bind(z(n)),n.keyUpHandler=n.keyUpHandler.bind(z(n)),n.blurHandler=n.blurHandler.bind(z(n)),n.getValue=n.getValue.bind(z(n)),n.setValue=n.setValue.bind(z(n)),n}return $(l,[{key:"getValue",value:function(){return this.state.value}},{key:"setValue",value:function(e){this.setState({value:e,show:!1})}},{key:"onChange",value:function(e){var n=e.target.value.toString();this.setValue(n),this.props.onChange&&this.props.onChange(n,n,this.props.name)}},{key:"keyUpHandler",value:function(e){this.props.onKeyUp&&this.props.onKeyUp(e)}},{key:"blurHandler",value:function(e){this.props.validate&&this.props.validate(this.state.value),this.props.onBlur&&this.props.onBlur(e.target.value,e.target.value,e)}},{key:"render",value:function(){return t().createElement(t().Fragment,null,t().createElement("div",{className:"wasabi-form-group "+(this.props.className||"")}," ",t().createElement("div",{className:"wasabi-form-group-body"+(this.props.readOnly||this.props.disabled?" readOnly":"")},t().createElement("input",{id:this.props.id,type:this.props.type,name:this.props.name,readOnly:this.props.readOnly,className:"wasabi-input ",onChange:this.onChange,onKeyUp:this.keyUpHandler,onBlur:this.blurHandler,value:this.state.value||"",autoComplete:"off"}),this.props.children)))}}],[{key:"getDerivedStateFromProps",value:function(e,n){return e.value!==n.oldPropsValue?{value:e.value||"",oldPropsValue:e.value}:null}}]),l}(n.Component);var ee=$((function e(){G(this,e),this.isParent=null,this.id="",this.pId="",this.text="",this.title="",this.iconCls="",this.iconClose="",this.iconOpen="",this.open=!1,this.checked=!1,this.selectAble=!1,this.draggAble=!1,this.dropAble=!1,this.href=null,this.hide=!1,this.children=null,this.nodeid="",this.textid="",this.children=null,this._path=null,this.half=!1,this.isLast=!1}));const ne=function(e){var n=new ee;for(var t in e){var r;"function"!=typeof e[t]&&(n[t]=null!==(r=e[t])&&void 0!==r?r:n[t])}return n};function te(e){var n,r=ne(e),o=e.clickId,l=e.loadingId,a=e.selectAble,i=e.checkStyle,c=e.renameAble,d=e.removeAble,u=e.rename,s=e.onDoubleClick,f=e.onClick,h=e.onChecked,p=e.onExpand,y=e.onNodeDragStart,g=e.onNodeDragEnd,v=e.onNodeDrop,b=e.onNodeDragOver,m=e.onNodeDragLeave,k=e.onBlur,w=e.onKeyUp,x=e.beforeNodeRename,O=e.beforeNodeRemove,C=e.textFormatter,D=r.title||r.text,E=r.iconCls;r.isParent&&(E=r.open?r.iconOpen?r.iconOpen:r.iconCls:r.iconClose?r.iconClose:r.iconCls),l===r.id&&(E="icon-loading tree-loading");var I,S,j=!1===r.open?0:(null==r||null===(n=r.children)||void 0===n?void 0:n.length)||0,A=20,R=[];if(r._path.length>1)for(var N=1;N<r._path.length;N++)R.push(t().createElement("span",{key:N,style:{width:20}})),A+=20;if(r.isParent){if(r.open?e.arrowUnFoldIcon&&(I=t().createElement("div",{className:"wasabi-tree-li-icon",style:{display:"inline-block"},onClick:r.isParent?p:null},e.arrowUnFoldIcon)):e.arrowFoldIcon&&(I=t().createElement("div",{className:"wasabi-tree-li-icon",style:{display:"inline-block"},onClick:r.isParent?p:null},e.arrowFoldIcon)),!I){var _="tree"===e.componentType?"icon-caret":"icon-arrow";I=t().createElement("i",{className:(o===r.id?" selected ":"")+(r.open?" wasabi-tree-li-icon  ".concat(_,"-down "):" wasabi-tree-li-icon  ".concat(_,"-right")),onClick:r.isParent?p:null},t().createElement("span",{className:"wasabi-tree-li-icon-beforeRight"}),t().createElement("span",{className:"wasabi-tree-li-icon-afterBelow",style:{height:(j+1)*H+(r._isLast?-30:0)}}))}}else I=t().createElement("i",{className:(o===r.id?" selected ":"")+" wasabi-tree-li-icon-line"},t().createElement("span",{className:"wasabi-tree-li-icon-afterBelow",style:{height:(j+1)*H+(r._isLast?-30:0)}}));"checkbox"===i&&(a||r.selectAble)?S=t().createElement(L,{half:r.half,name:"node"+r.id,className:(o===r.id?" selected ":"")+(j>0?" hasChildren ":"  "),value:r.checked?r.id:"",data:[{value:r.id,text:""}],onSelect:h}):"radio"===i&&(a||r.selectAble)?S=t().createElement(K,{type:"radio",half:r.half,name:"node"+r.id,className:(o===r.id?" selected ":"")+(j>0?" hasChildren ":"  "),value:r.checked?r.id:"",data:[{value:r.id,text:""}],onSelect:h}):"function"==typeof i&&r.selectAble&&(S=i(r)),S&&(A+=20);var T=r.text;return C&&"function"==typeof C&&(T=C(r)),t().createElement("li",{className:"wasabi-tree-li",key:r.id,style:{display:r.hide?"none":"flex"}},R,I,S,t().createElement("div",{id:r.nodeid,style:{width:"calc(100% - ".concat(A,"px)")},className:o===r.id?"wasabi-tree-li-node selected":"wasabi-tree-li-node",title:D,onDrop:v,onDragOver:b,onDragLeave:m,onClick:f,onDoubleClick:s},u?t().createElement(Z,{id:r.textid,required:!0,onKeyUp:w,onBlur:k,name:"key"+r.id,value:r.text}):t().createElement("div",{key:"2",className:"wasabi-tree-li-node-text-div",draggable:r.draggAble,onDragEnd:g,onDragStart:y},t().createElement("i",{key:"3",className:(!r.selectAble&&j?" noCheckhasChildren ":"  ")+E+" wasabi-tree-text-icon"}),t().createElement("a",{href:r.href,className:"wasabi-tree-txt"},T)),!u&&c?t().createElement("i",{key:"edit",className:"icon-edit edit",title:"重命名",onClick:x}):null,!u&&d?t().createElement("i",{key:"delete",className:"icon-delete edit",title:"删除",onClick:O}):null))}function re(r){var o=c((0,n.useState)(!1),2),l=o[0],a=o[1],i=c((0,n.useState)(v()),1)[0],d=c((0,n.useState)(v()),1)[0];(0,n.useEffect)((function(){if(l){var e=document.getElementById(i);e&&e.focus()}}),[l]);var u=(0,n.useCallback)((function(){var e=ne(r);r.onClick&&r.onClick(e.id,e.text,e)}),[r]),s=(0,n.useCallback)((function(){var e=ne(r);r.onDoubleClick&&r.onDoubleClick(e.id,e.text,e)}),[r]),f=(0,n.useCallback)((function(e){var n=ne(r);r.onChecked&&r.onChecked(n.id,n.text,n,e)}),[r]),h=(0,n.useCallback)((function(){var e=ne(r),n=!e.open;r.onExpand&&r.onExpand(n,e.id,e.text,e)}),[r]),p=(0,n.useCallback)((function(e,n,t,o){a(!1),r.onRename&&r.onRename(e,n,t,o)}),[]),y=(0,n.useCallback)((function(){var e=!0;if(r.beforeRename){var n=ne(r);e=r.beforeRename(n.id,n.text,n)}a(e)}),[r]),g=(0,n.useCallback)((function(e){var n=ne(r);p(n.id,n.text,n,e)}),[r]),b=(0,n.useCallback)((function(e){if(13===e.keyCode){var n=ne(r);p(n.id,n.text,n,e.target.value.trim())}}),[r]),m=(0,n.useCallback)((function(){var e=ne(r),n=!0;r.beforeRemove&&(n=r.beforeRemove(e.id,e.text,e)),n&&r.onRemove&&r.onRemove(e.id,e.text,e)}),[r]),k=(0,n.useCallback)((function(e){var n=ne(r);if(n.draggAble){var t=!0;r.beforeDrag&&(t=r.beforeDrag((n.id,n.text,n))),t&&(e.dataTransfer.setData("drag",JSON.stringify(n)),window.localStorage.setItem("wasabi-drag-item",JSON.stringify(n)),r.onDrag&&r.onDrag(n.id,n.text,n))}}),[r]),w=(0,n.useCallback)((function(e){e.preventDefault()}),[]),x=(0,n.useCallback)((function(e){if(e.preventDefault(),ne(r).dropAble){var n=document.getElementById(d).getBoundingClientRect().top,t=e.clientY;t-n<10?(document.getElementById(d).style.borderTop="1px solid var(--border-color)",document.getElementById(d).style.borderBottom="none",document.getElementById(d).style.backgroundColor=null,window.localStorage.setItem("wasabi-drag-type","before")):t-n<30?(document.getElementById(d).style.borderTop="none",document.getElementById(d).style.borderBottom="none",document.getElementById(d).style.backgroundColor="var(--background-color)",window.localStorage.setItem("wasabi-drag-type","in")):(document.getElementById(d).style.borderTop="none",document.getElementById(d).style.borderBottom="1px solid var(--border-color)",document.getElementById(d).style.backgroundColor=null,window.localStorage.setItem("wasabi-drag-type","after"))}}),[r]),O=(0,n.useCallback)((function(e){e.preventDefault(),document.getElementById(d).style.borderTop="none",document.getElementById(d).style.borderBottom="none",document.getElementById(d).style.backgroundColor=null}),[]),C=(0,n.useCallback)((function(e){e.preventDefault();var n=ne(r);document.getElementById(d).style.borderTop="none",document.getElementById(d).style.borderBottom="none",document.getElementById(d).style.backgroundColor=null;var t=JSON.parse(e.dataTransfer.getData("drag")),o=window.localStorage.getItem("wasabi-drag-type");if(t&&n.dropAble){var l=!0;r.beforeDrop&&(l=r.beforeDrop(t,n,o)),l&&(window.localStorage.removeItem("wasabi-drag-type"),r.onDrop&&r.onDrop(t,n,o))}}),[r]);return t().createElement(te,e({},r,{rename:l,textid:i,nodeid:d,onClick:u,onDoubleClick:s,onChecked:f,onExpand:h,onBlur:g,onKeyUp:b,beforeNodeRename:y,beforeNodeRemove:m,onNodeDragEnd:w,onNodeDragLeave:O,onNodeDragOver:x,onNodeDragStart:k,onNodeDrop:C}))}te=t().memo(te),re.propTypes={isParent:s().bool,id:s().oneOfType([s().number,s().string]).isRequired,text:s().oneOfType([s().number,s().string]).isRequired,title:s().string,arrowFoldIcon:s().node,arrowUnFoldIcon:s().node,iconCls:s().string,iconClose:s().string,iconOpen:s().string,open:s().bool,checked:s().bool,selectAble:s().bool,draggAble:s().bool,dropAble:s().bool,href:s().string,hide:s().bool,children:s().array,onClick:s().func,onDoubleClick:s().func,onCheck:s().func,onCollapse:s().func,onExpand:s().func,onRename:s().func,onRemove:s().func,onRightClick:s().func,onDrag:s().func,onDrop:s().func,beforeDrag:s().func,beforeDrop:s().func,beforeRemove:s().func,beforeRename:s().func,beforeRightClick:s().func},re.defaultProps={iconCls:"icon-text",iconClose:"icon-folder",iconOpen:"icon-folder-open",checked:!1,selectAble:!1,open:!1,half:!1,draggAble:!1,dropAble:!1,children:[]};const oe=t().memo(re,(function(e,n){return!b(e,n,!1)}));function le(n){var r=[],o={componentType:n.componentType,selectAble:n.selectAble,checkStyle:n.checkStyle,renameAble:n.renameAble,removeAble:n.removeAble,asyncAble:n.asyncAble,clickId:n.clickId,loadingId:n.loadingId},l={beforeDrag:n.beforeDrag,beforeRemove:n.beforeRemove,beforeDrop:n.beforeDrop,beforeRename:n.beforeRename,onClick:n.onClick,onDoubleClick:n.onDoubleClick,onChecked:n.onChecked,onRemove:n.onRemove,onExpand:n.onExpand,onRename:n.onRename,onDrop:n.onDrop,onDrag:n.onDrag,textFormatter:n.textFormatter},a=n.visibleData;return Array.isArray(a)&&(r=a.map((function(n,r){var a=!1;return(!0===n.isParent||Array.isArray(n.children)&&n.children.length>0)&&(a=!0),t().createElement(oe,e({key:"treenode-"+n.id},o,n,{isParent:a},l))}))),t().createElement("ul",{id:n.treeid,className:"wasabi-tree clearfix "+(!1===n.dotted?" nodotted ":"")},r)}const ae=t().memo(le);function ie(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function ce(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?ie(Object(t),!0).forEach((function(n){d(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ie(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var de,ue=function(e){de||(de=document.getElementById(e).clientHeight||window.innerHeight);var n=Math.ceil(de/H),t=document.getElementById(e).scrollTop||0,r=Math.floor(t/H)||0;return{visibleDataCount:n,startIndex:r,endIndex:r+1*n}},se=function(e,n,t){var r,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=[],i=e.filterData,c=e.flatData;return a=""!==(null!=l?l:"").toString()?(i=F(e.flatData,l)).slice(n,t):""!==(null!==(r=e.filterValue)&&void 0!==r?r:"").toString()?i.slice(n,t):(c=o&&k(o)||e.flatData).slice(n,t),ce(ce({},e),{},{filterValue:l,data:o,filterData:i,flatData:c,visibleData:a,sliceBeginIndex:n,sliceEndIndex:t,loadingId:null})},fe=function(e,n,t,r){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,i={type:n||"post",contentType:t,url:e,headers:r||{},data:o,success:l,error:a},c=window.api||U();c.ajax(i),console.log("tree async-fetch",i)},he=function(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;try{var r=window.sessionStorage.getItem("async-tree-node");if(r=r?JSON.parse(r):{},"function"==typeof t.loadSuccess){var o=t.loadSuccess(n);e=o&&o instanceof Array?o:n}else e=g(n,t.dataSource);return x(e,r.id,r._path,t.idField,t.parentField,t.textField,t.childrenField,t.simpleData)}catch(e){console.error("handerLoadData",e)}return[]},pe=function(e,n){try{var t=null,r=n.payload;switch(n.type){case"loading":return ce(ce({},e),{},{loadingId:r});case"onClick":case"onDoubleClick":return ce(ce({},e),{},{clickId:r});case"onChecked":var o=r.id+""==r.checkValue+"";return t=[],"checkbox"===r.checkStyle?t=S(e.data,r.row,o,r.checkType):"radio"===r.checkStyle&&(t=j(e.data,r.row,o,r.radioType)),se(e,e.sliceBeginIndex,e.sliceEndIndex,t);case"setChecked":if(r.id&&D(e.data,r.id))return"checkbox"===r.checkStyle?t=S(e.data,r.node,!!r.checked,r.checkType):"radio"===r.checkStyle&&(t=j(e.data,r.node,!!r.checked,r.radioType)),se(e,e.sliceBeginIndex,e.sliceEndIndex,t);case"clearChecked":return t=N(e.data),se(e,e.sliceBeginIndex,sliceEndIndex,t);case"checkedAll":return t=_(e.data),se(e,e.sliceBeginIndex,e.sliceEndIndex,t);case"onRename":return t=function(e,n,t){if(e&&e.length>0){var r,o=I(e,null!==(r=n._path)&&void 0!==r?r:D(n.id)._path);o&&(o[o.length-1].text=t)}return e}(e.data,r.row,r.newText),se(e,e.sliceBeginIndex,e.sliceEndIndex,t);case"onRemove":return t=T(e.data,r.row),se(e,e.sliceBeginIndex,e.sliceEndIndex,t);case"onDrop":var l=r.dragNode,i=r.dropNode,c=r.dragType;if(l.id!==i.id)return t=null,"in"==c?l.pId!==i.id&&(t=function(e,n,t){var r=I(e,n._path),o=I(e,t._path);if(o){var l=r[r.length-1],a=o[o.length-1];a.open=!0,a.children||(a.children=[]),a.children.push(C(C({},l),{},{pId:a.id,_path:[].concat(w(a._path),[a.children.length]),children:B(l.id,[].concat(w(l._path),[l.children.length]),l.children)})),e=T(e,l)}return e}(e.data,l,i)):"before"==c?t=function(e,n,t){return P(e,n,t,0)}(e.data,l,i):"after"==c&&(t=function(e,n,t){return P(e,n,t,1)}(e.data,l,i)),t?se(e,e.sliceBeginIndex,e.sliceEndIndex,t):e;case"showVisibleData":return se(e,r.sliceBeginIndex,r.sliceEndIndex,r.data,r.filterValue);case"setOpen":return t=function(e,n,t){try{var r;return(n=E(e,null!==(r=n._path)&&void 0!==r?r:D(n.id)._path)).open=t,e}catch(e){}}(e.data,r.row,r.open),se(e,e.sliceBeginIndex,e.sliceEndIndex,t);case"remove":return t=T(e.data,a),se(e,e.sliceBeginIndex,e.sliceEndIndex,t);case"append":var d=r.children,u=r.row;return t=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1?arguments[1]:void 0,t=arguments.length>2?arguments[2]:void 0;if(t){t._path||(t=D(e,t.id));var r=I(e,t._path);if(r&&r.length>0){var o,l=r[r.length-1],a=null!==(o=l.children)&&void 0!==o?o:[];l.children=[].concat(a,n),l.children=B(l.id,l._path,l.children)}return e}return B("",[],e=e.concat(n))}(e.data,d,u),se(e,e.sliceBeginIndex,e.sliceEndIndex,t);default:return e}}catch(e){console.log("reduce error",e)}};function ye(r,o){var l=c((0,n.useState)(v()),1)[0],a=c((0,n.useState)(v()),1)[0],i=(0,n.useRef)(null),d=c((0,n.useReducer)(pe,{filterValue:null,data:null,flatData:null,filterData:null,visibleData:null,sliceBeginIndex:0,sliceEndIndex:0,loadingId:null,clickId:null}),2),u=d[0],s=d[1],f=(0,n.useCallback)((function(e,n,t){var o;s({type:"onClick",payload:e}),null==i||null===(o=i.current)||void 0===o||o.setFocus(e),r.onClick&&r.onClick(e,n,t)}),[]),h=(0,n.useCallback)((function(e,n,t){s({type:"onDoubleClick",payload:e}),r.onDoubleClick&&r.onDoubleClick(e,n,t)}),[]),p=(0,n.useCallback)((function(e,n,t,o){s({type:"onChecked",payload:{id:e,text:n,row:t,checkValue:o,checkType:r.checkType,checkStyle:r.checkStyle,radioType:r.radioType}});var l=(null!=e?e:"").toString()===(null!=o?o:"").toString();r.onChecked&&r.onChecked(l,e,n,t)}),[]),g=(0,n.useCallback)((function(e,n,t){Msg.confirm("您确定删除【"+n+"]吗",(function(){s({type:"onRemove",payload:{id:e,text:n,row:t}}),r.onRemove&&r.onRemove(e,n,t)}))}),[]),b=(0,n.useCallback)((function(e,n,t,o){s({type:"onRename",payload:{id:e,text:n,row:t,newText:o}}),r.onRename&&r.onRename(e,n,t,o)}),[]),m=(0,n.useCallback)((function(e,n,t){s({type:"onDrop",payload:{dragNode:e,dropNode:n,dragType:t}})}),[]),k=(0,n.useCallback)((function(e){try{s({type:"loading",payload:null});var n=he(e,r),t=window.sessionStorage.getItem("async-tree-node");t=t?JSON.parse(t):null,s({type:"append",payload:{children:n,row:t}})}catch(e){console.error("loadSuccess",e)}finally{window.sessionStorage.removeItem("async-tree-node")}}),[]),w=(0,n.useCallback)((function(){s({type:"loading",payload:null})}),[]),O=(0,n.useCallback)((function(e,n,t,o){if(s({type:"setOpen",payload:{row:o,open:e}}),r.asyncAble&&(!o.children||0==o.children.length)){var l=[];if(r.onAsync&&"function"==typeof r.onAsync)l=r.onAsync(n,t,o),Array.isArray(l)&&(l=he(l,r),s({type:"append",payload:{children:l,row:o}}));else if(r.url){s({type:"loading",payload:n}),window.sessionStorage.setItem("async-tree-node",JSON.stringify(o));var a=y(r.params)||{};a[r.idField||"id"]=n,fe(r.url,r.httpType,r.contentType,r.headers,a,k,w)}}r.onExpand&&r.onExpand(e,n,t,o)}),[r.url,r.httpType,r.contentType,r.params,r.headers,r.idField]),C=(0,n.useCallback)((function(){var e=ue(l);D(e.startIndex,e.endIndex,e.visibleDataCount,u.data)}),[]),D=(0,n.useCallback)((function(e,n,t){var r,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;if(e>=1){var i=(e+1)*H-(e-1*t>=0?(e-1*t)*H:0);r=e*H-i}else r=0;document.getElementById(a).style.transform="translate3d(0,".concat(r,"px,0)");var c=e-1*t,d=n+1*t;s({type:"showVisibleData",payload:{sliceBeginIndex:c=c<0?0:c,sliceEndIndex:d,data:o,filterValue:l}})}),[]);(0,n.useImperativeHandle)(o,(function(){return{getChecked:function(){return R(u.data)},setChecked:function(e,n){null!=e&&""!==e&&s({type:"setChecked",payload:{id:e,checked:n,checkType:r.checkType,checkStyle:r.checkStyle,radioType:r.radioType}})},clearChecked:function(){s({type:"clearChecked"})},checkedAll:function(){s({type:"checkedAll"})},setClick:function(e){var n;s({type:"setClick",payload:e}),null==i||null===(n=i.current)||void 0===n||n.setFocus(e),onscroll()},setOpen:function(e,n){s({type:"setOpen",payload:{id:e,open:n}})},remove:function(e){s({type:"remove",payload:e})},filter:function(e){document.getElementById(l).scrollTop=0;var n=ue(l);D(n.startIndex,n.endIndex,n.visibleDataCount,u.data,e)},append:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;e&&e.length>0&&s({type:"append",payload:{children:e,row:n}})},adjust:function(){onscroll()}}})),(0,n.useEffect)((function(){if(r.url)C([]),fe(r.url,r.httpType,r.contentType,r.headers,r.params,k,w);else{var e=x(r.data,"",[],r.idField,r.parentField,r.textField,r.childrenField,r.simpleData),n=ue(l);D(n.startIndex,n.endIndex,n.visibleDataCount,e||[])}}),[r.url,r.data]);var E,I={beforeDrag:r.beforeDrag,beforeRemove:r.beforeRemove,beforeDrop:r.beforeDrop,beforeRename:r.beforeRename,onDrag:r.onDrag,onClick:f,onDoubleClick:h,onChecked:p,onRemove:g,onExpand:O,onRename:b,onDrop:m};return r.componentType&&"tree"!==r.componentType?"treegrid"===r.componentType&&(E=t().createElement(TreeGridView,e({ref:i},r,u,I,{treeid:a}))):E=t().createElement(ae,e({},r,u,I,{treeid:a})),t().createElement("div",{id:l,onScroll:C,className:"wasabi-tree-parent "+(r.className||""),style:r.style},E,t().createElement("div",{style:{left:0,top:0,height:u.flatData&&u.flatData.length*H,position:"absolute",width:1}}))}(ye=t().forwardRef(ye)).propTypes={componentType:s().oneOf(["tree","treegrid"]),name:s().string,idField:s().string,parentField:s().string,textField:s().string,childrenField:s().string,dotted:s().bool,url:s().string,params:s().object,dataSource:s().string,headers:s().array,data:s().array,simpleData:s().bool,selectAble:s().bool,checkStyle:s().oneOf(["checkbox","radio",s().func]),checkType:s().object,radioType:s().oneOf(["level","all"]),renameAble:s().bool,removeAble:s().bool,asyncAble:s().bool,onClick:s().func,onDoubleClick:s().func,onCheck:s().func,onExpand:s().func,onRename:s().func,onRemove:s().func,onRightClick:s().func,onDrag:s().func,onDrop:s().func,onAsync:s().func,beforeDrag:s().func,beforeDrop:s().func,beforeRemove:s().func,beforeRename:s().func,beforeRightClick:s().func},ye.defaultProps={componentType:"tree",idField:"id",parentField:"pId",textField:"text",childrenField:"children",dataSource:"data",dotted:!0,simpleData:!1,selectAble:!1,checkStyle:"checkbox",checkType:{y:"ps",n:"ps"},radioType:"all"};const ge=t().memo(ye);function ve(n,r){return t().createElement(ge,e({},n,{ref:r,componentType:"tree"}))}const be=t().memo(t().forwardRef(ve))})(),i})()}));