!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("prop-types"),require("react"),require("wasabi-api")):"function"==typeof define&&define.amd?define(["prop-types","react","wasabi-api"],t):"object"==typeof exports?exports["wasabi-tree"]=t(require("prop-types"),require("react"),require("wasabi-api")):e["wasabi-tree"]=t(e["prop-types"],e.react,e["wasabi-api"])}(self,(function(e,t,n){return(()=>{"use strict";var r={99:t=>{t.exports=e},156:e=>{e.exports=t},313:e=>{e.exports=n}},o={};function l(e){var t=o[e];if(void 0!==t)return t.exports;var n=o[e]={exports:{}};return r[e](n,n.exports,l),n.exports}l.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return l.d(t,{a:t}),t},l.d=(e,t)=>{for(var n in t)l.o(t,n)&&!l.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},l.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),l.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var i={};return(()=>{function e(){return e=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},e.apply(this,arguments)}l.r(i),l.d(i,{default:()=>X});var t=l(156),n=l.n(t);function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function o(e,t){if(e){if("string"==typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}}function c(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a=[],l=!0,i=!1;try{for(n=n.call(e);!(l=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);l=!0);}catch(e){i=!0,o=e}finally{try{l||null==n.return||n.return()}finally{if(i)throw o}}return a}}(e,t)||o(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var u=l(99),s=l.n(u);function f(e){return function(e){if(Array.isArray(e))return r(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||o(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function h(e){return h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},h(e)}function p(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function g(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?p(Object(n),!0).forEach((function(t){d(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):p(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var y={titleize:function(e){return e.toLowerCase().replace(/(?:^|\s)\w/g,(function(e){return e.toUpperCase()}))},camelize:function(e){return e.replace(/[-_\s]+(.)?/g,(function(e,t){return t?t.toUpperCase():""}))},dasherize:function(e){return e.replace(/([A-Z])/g,"-$1").replace(/[-_\s]+/g,"-").toLowerCase()},GetArgsFromHref:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0,n=(t=t||window.location.href).toString().split("?"),r="";if(n[0]==t)return r;var o=n[1];o.indexOf("#")>-1&&(o=(o=o.split("#"))[0].indexOf("=")>-1?o[0]:o[1]),n=o.toString().split("&");for(var a=0;a<n.length;a++){var l=(o=n[a]).toString().split("=");l.length<=1||l[0]==e&&(r=l[1])}return r},BrowserType:function(){var e="",t=navigator.userAgent.toLowerCase();return t.indexOf("opera")>-1||t.indexOf("opr")>-1?e="Opera":t.indexOf("firefox")>-1?e="Firefox":t.indexOf("chrome")>-1?e="Chrome":t.indexOf("safari")>-1?e="Safari":/msie|trident/.test(t)&&(e=y.IEType()),e},IEType:function(){return navigator.userAgent.indexOf("MSIE 6.")>-1?"IE 6":navigator.userAgent.indexOf("MSIE 7.")>-1?"IE 7":navigator.userAgent.indexOf("MSIE 8.")>-1?"IE 8":navigator.userAgent.indexOf("MSIE 9.")>-1?"IE 9":navigator.userAgent.indexOf("MSIE 10.")>-1?"IE 10":navigator.userAgent.toLowerCase().indexOf("trident")>-1?"IE 11":void 0},dealNumToEnglishFormat:function(e){return isNaN(e)?e:e.toString().split("").reverse().join("").replace(/(.{3})/g,"$1,").split("").reverse().join("").replace(/^,/,"")},dateformat:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Date,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"yyyy-MM-dd HH:mm:ss";if(e){var n={"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours()%12==0?12:e.getHours()%12,"H+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds(),"q+":Math.floor((e.getMonth()+3)/3),S:e.getMilliseconds()},r={0:"日",1:"一",2:"二",3:"三",4:"四",5:"五",6:"六"};for(var o in/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length))),/(E+)/.test(t)&&(t=t.replace(RegExp.$1,(RegExp.$1.length>1?RegExp.$1.length>2?"星期":"周":"")+r[e.getDay()+""])),n)new RegExp("("+o+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?n[o]:("00"+n[o]).substr((""+n[o]).length)));return t}},stringToDate:function(e){return new Date(Date.parse(e.replace(/-/g,"/")))}};y.cookies={set:function(e,t){var n=new Date;n.setTime(n.getTime()+6048e5),document.cookie=e+"="+t+";path=/;expires="+n.toGMTString()},get:function(e){var t,n=new RegExp("(^| )"+e+"=([^;]*)(;|$)");return(t=document.cookie.match(n))?t[2]:null},del:function(e){var t=new Date;t.setTime(t.getTime()-1);var n=this.get(e);null!==n&&(document.cookie=e+"="+n+";expires="+t.toGMTString())}},y.clone=function(e){var t;if("object"===h(e))if(null===e)t=null;else if(e instanceof Array){t=[];for(var n=0;n<e.length;n++)t.push(y.clone(e[n]))}else if(e instanceof Date)t=new Date(e.valueOf());else if(e instanceof Map)t=new Map(e);else if(e instanceof Set)t=new Set(e);else for(var r in t={},e)t[r]=y.clone(e[r]);else t=e;return t},y.shallowClone=function(e){return"object"===h(e)?null===e?null:e instanceof Array?e.slice(0):e instanceof Date?new Date(e.valueOf()):e instanceof Map?new Map(e):e instanceof Set?new Set(e):g({},e):e},y.getSource=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"data",n=new Array,r=e;t.indexOf(".")>-1?n=t.split("."):n.push(t);var o=0;try{for(;o<n.length;){if(null==(r=r[n[o]]))return null;o++}}catch(e){return null}return r},y.isEmptyObject=function(e){var t=!0;if("object"===h(e))for(var n in e)t=!1;return t},y.download=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:".xlsx";"object"==h(e)&&e instanceof Blob?e=URL.createObjectURL(e):n=e.substr(e.lastIndexOf(".")),t=t||y.dateformat(new Date,"yyyy-MM-dd HH:mm:ss");var r=document.createElement("a");r.href=e,r.download=t+n,r.click(),window.URL.revokeObjectURL(r.href)},y.uuid=function(){for(var e=[],t="0123456789abcdef",n=0;n<36;n++)e[n]=t.substr(Math.floor(16*Math.random()),1);return e[14]="4",e[19]=t.substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]="-",e.join("")},y.diff=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(e===t)return!1;if(Object.prototype.toString.call(e)!==Object.prototype.toString.call(t))return!0;if("function"==typeof e)return e.toString()!==t.toString();if("object"!==h(e))return e!==t;try{if(Object.prototype.toString.call(e).indexOf("Map")>-1||Object.prototype.toString.call(e).indexOf("Set")>-1)return e!==t;var r=Object.getOwnPropertyNames(e),o=Object.getOwnPropertyNames(t);if(r.length!==o.length)return!0;for(var a=0;a<r.length;a++){var l=r[a],i=e[l],c=t[l];if(n){if(y.diff(i,c,n))return!0}else{if("function"==typeof i)return e.toString()!==t.toString();if(i!==c)return!0}}}catch(n){console.log(e,t)}return!1},y.componentMixins=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];try{t.forEach((function(t){Object.getOwnPropertyNames(t).forEach((function(n){"function"==typeof t[n]&&(e.prototype[n]=t[n])}))}))}catch(e){}return e},y.toTreeData=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"id",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"pId",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"text";e=y.clone(e);for(var o=[],a={},l=0,i="",c="",d=0;d<e.length;d++)c+=","+e[d][t]+",";for(var u=0;u<e.length;u++)c.indexOf(","+e[u][n]+",")<=-1&&(i+=","+e[u][n]+",");for(var s=0;0!==e.length&&l<2e6;){if(l++,i.indexOf(","+e[s][n]+",")>-1||!e[s][n]){var f=g(g({},e[s]),{},{id:e[s][t],pId:e[s][n],text:e[s][r],children:[]});o.push(f),a[e[s][t]]=[o.length-1],f._path=[o.length-1],f.children=y.formatTreeDataChildren(e[s].children,f.id,f._path,t,n,r),e.splice(s,1),s--}else{var h=a[e[s][n]];if(h){for(var p=o[h[0]],v=1;v<h.length;v++)p=p.children[h[v]];var b=g(g({},e[s]),{},{id:e[s][t],pId:e[s][n],text:e[s][r],children:e[s].children||[]});p.children.push(b),a[e[s][t]]=h.concat([p.children.length-1]),b._path=a[e[s][t]],b.children=y.formatTreeDataChildren(e[s].children,b.id,b._path,t,n,r),e.splice(s,1),s--}}++s>e.length-1&&(s=0)}return e.length>0&&console.error("数据格式不正确，或者是数据量过大，请使用异步请求"),o},y.formatTreeDataChildren=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"id",o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"pId",a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"text";if(e&&e instanceof Array&&e.length>0){for(var l=0;l<e.length;l++){var i=[].concat(f(n),[l]);e[l]=g(g({},e[l]),{},{id:e[l][r],pId:t,text:e[l][a],_path:i,children:y.formatTreeDataChildren(e[l].children,e[l][r],i,r,o,a)})}return e}return[]},y.treeDataToFlatData=function(e){var t=[];if(e&&e instanceof Array)for(var n=0;n<e.length;n++)t.push(g(g({},e[n]),{},{isLast:n===e.length-1})),e[n].children&&e[n].children.length>0&&!1!==e[n].open&&(t=t.concat(y.treeDataToFlatData(e[n].children)));return t},y.deepMerge=function(e,t){for(var n in t)"[object Object]"===e[n].toString()?y.deepMerge(e[n],t[n]):e[n]=t[n];return e},y.arrayNodupMerge=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"id",r=[].concat(e,t),o=[],a={},l=0;l<r.length;l++)a[r[l][n]]||(o.push(r[l]),a[r[l][n]]=!0);return o},y.charWidth=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=0;try{for(var n=e.split(""),r=0;r<n.length;r++){var o=new RegExp("[\\u4E00-\\u9FFF]+","g");o.test(n[r])?t+=20:t+=10}}catch(e){}return t},y.throttle=function(e,t){var n=Date.now();return function(){var r=this,o=arguments,a=Date.now();a-n>=t&&(e.apply(r,o),n=Date.now())}},y.getDateDiffDay=function(e,t){try{return(1*e-1*t)/60/60/1e3/24}catch(e){return NaN}},y.getFirstDateInMonth=function(e){return new Date(e.getFullYear(),e.getMonth(),1)},y.getLastDateInMonth=function(e){return new Date(e.getFullYear(),e.getMonth()+1,0)},y.getFirstDateInQuarter=function(e){return new Date(e.getFullYear(),3*~~(e.getMonth()/3),1)},y.getLastDateInQuarter=function(e){return new Date(e.getFullYear(),3*~~(e.getMonth()/3)+3,0)},y.isLeapYear=function(e){return 29===new Date(e.getFullYear(),2,0).getDate()},y.getDaysInMonth=function(e){return new Date(e.getFullYear(),e.getMonth()+1,0).getDate()},y.getFirstDayWeek=function(e){return new Date(e.getFullYear(),e.getMonth(),1).getDay()},y.getNextYear=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=y.clone(e);return n.setYear(n.getFullYear()+t),n},y.getNextMonth=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=y.clone(e);return n.setMonth(n.getMonth()+t),n},y.getNextDay=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=y.clone(e);return n.setDate(n.getDate()+t),n},y.getNextHour=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=y.clone(e);return n.setHours(n.getHours()+t),n};const v=y,b=function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"value",a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"text",l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"pId",i=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];if(!r)return r;var c=v.clone(r);if(c&&c instanceof Array&&c.length>0)for(var d=0;d<c.length;d++)"tree"==t||"treepicker"==t||"treegrid"==t?c[d].id=c[d].id||c[d][o]:c[d].value=c[d].value||c[d][o],c[d].text=c[d].text||c[d][a],n&&(","+n+",").indexOf(","+("tree"==t||"treepicker"==t?c[d].id:c[d].value)+",")>-1&&(c[d].checked=!0),c[d].children&&c[d].children.length>0&&(c[d].children=e(t,n,c[d].children,o,a,l,i));return"tree"!==t&&"treepicker"!==t&&"treegrid"!==t||!i||(c=v.toTreeData(c,o,l,a)),c};function m(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function k(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?m(Object(n),!0).forEach((function(t){d(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):m(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var w={findNodeById:function(e,t){var n;if(e&&e.length>0&&null!=t&&""!==t)for(var r=0;r<e.length;r++){if(e[r].id===t)return e[r];if(e[r].children&&e[r].children instanceof Array&&e[r].children.length>0&&(n=w.findNodeById(e[r].children,t)))return n}return n},findNodeByPath:function(e,t){var n;if(e&&e.length>0&&t&&t.length>0&&(n=e[t[0]],t&&t.length>1))for(var r=1;r<t.length;r++)n.children&&n.children.length>0&&(n=n.children[t[r]]);return n},findLinkNodesByPath:function(e,t){var n=[];if(e&&e.length>0&&t&&t.length>0&&(n=[e[t[0]]],t&&t.length>1))for(var r=1;r<t.length;r++)n[n.length-1].children&&n[n.length-1].children.length>0&&n.push(n[n.length-1].children[t[r]]);return n},setSelfChecked:function(e,t){if(e)for(var n=0;n<t.length;n++)(","+e+",").indexOf(","+t[n].id+",")>-1?t[n].checked=!0:t[n].checked=!1,t[n].children&&t[n].children.length>0&&(t[n].children=w.setSelfChecked(e,t[n].children));return t},setChecked:function(e,t,n,r){try{var o=this.findLinkNodesByPath(e,t._path);if(o&&o.length>0){var a=o[o.length-1];a.checked=!!n,(n&&r&&r.y&&r.y.indexOf("s")>-1||!n&&r&&r.n&&r.n.indexOf("s")>-1)&&(a=this.setNodeChildrenChecked(a,a.checked)),(a.checked&&r&&r.y&&r.y.indexOf("p")>-1||!a.checked&&r&&r.n&&r.n.indexOf("p")>-1)&&this.setNodeParentsChecked(o)}}catch(e){}return e},setRadioChecked:function(e,t,n,r){try{if("all"==r){var o;e=w.clearChecked(e);var a=this.findNodeByPath(e,null!==(o=a._path)&&void 0!==o?o:w.findNodeById(a.id)._path);a.checked=n,a.half=!1}else if("level"==r){var l,i=this.findLinkNodesByPath(e,t._path?t._path:null===(l=w.findNodeById(t.id))||void 0===l?void 0:l._path);if(i&&i.length>=2){var c=i[i.length-2];if(c.children&&c.children.length>0)for(var d=0;d<c.children.length;d++)c.children[d].checked=!1,c.children[d].half=!1}else if(i&&1==i.length)for(var u=0;u<e.length;u++)e[u].checked=!1,e[u].half=!1;i&&i.length>0&&(i[i.length-1].checked=n,i[i.length-1].half=!1)}}catch(e){console.log(e)}return e},setNodeChildrenChecked:function(e,t){if(e.checked=t,e.half=!1,e.children&&e.children.length>0)for(var n=0;n<e.children.length;n++)e.children[n]=this.setNodeChildrenChecked(e.children[n],t);return e},setNodeParentsChecked:function(e){if(e&&e.length>1)for(var t=e.length-2;t>=0;t--)if(e[t].children&&e[t].children.length>0){for(var n=0,r=0,o=0;o<e[t].children.length;o++)e[t].children[o].checked&&n++,e[t].children[o].half&&r++;n===e[t].children.length?(e[t].checked=!0,e[t].half=!1):n>0&&n!==e[t].children.length||r>0?(e[t].checked=!1,e[t].half=!0):(e[t].checked=!1,e[t].half=!1)}},getChecked:function(e){var t=[];if(e&&e instanceof Array&&e.length>0)for(var n=0;n<e.length;n++)e[n].checked&&t.push(e[n]),e[n].children&&e[n].children.length>0&&(t=[].concat(t,this.getChecked(e[n].children)));return t},clearChecked:function(e){if(e&&e instanceof Array&&e.length>0){for(var t=0;t<e.length;t++)e[t].checked=!1,e[t].half=!1,e[t].children&&e[t].children.length>0&&(e[t].children=w.clearChecked(e[t].children));return e}},checkedAll:function(e){if(e&&e instanceof Array&&e.length>0){for(var t=0;t<e.length;t++)e[t].checked=!0,e[t].half=!1,e[t].children&&e[t].children.length>0&&(e[t].children=w.checkedAll(e[t].children));return e}},setOpen:function(e,t,n){var r;return(t=this.findNodeByPath(e,null!==(r=t._path)&&void 0!==r?r:w.findNodeById(t.id)._path)).open=n,e},renameNode:function(e,t,n){if(e&&e.length>0){var r,o=w.findLinkNodesByPath(e,null!==(r=t._path)&&void 0!==r?r:w.findNodeById(t.id)._path);o&&(o[o.length-1].text=n)}return e},removeNode:function(e,t){var n,r=w.findLinkNodesByPath(e,null!==(n=t._path)&&void 0!==n?n:w.findNodeById(t.id)._path);if(1==r.length)try{return e.splice(r[0]._path[0],1),w.setPath(e)}catch(e){console.log("removeNode",r)}else{var o=r[r.length-2];o.children.splice(t._path[t._path.length-1],1),o.children=w.setChildrenPath(o.id,o._path,o.children)}return e},moveInNode:function(e,t,n){var r=w.findLinkNodesByPath(e,t._path),o=w.findLinkNodesByPath(e,n._path);if(o){var a=r[r.length-1],l=o[o.length-1];l.children||(l.children=[]),l.children.push(k(k({},a),{},{pId:l.id,_path:[].concat(f(l._path),[l.children.length]),children:w.setChildrenPath(a.id,[].concat(f(a._path),[a.children.length]),a.children)})),e=w.removeNode(e,a)}return e},moveBeforeNode:function(e,t,n){return w.moveBeforeOrAfterNode(e,t,n,0)},moveAterNode:function(e,t,n){return w.moveBeforeOrAfterNode(e,t,n,1)},moveBeforeOrAfterNode:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;try{var o=w.findLinkNodesByPath(e,t._path),a=w.findLinkNodesByPath(e,n._path);if(o&&a){var l=o[o.length-1],i=a[a.length-1];if(1==a.length)e=[].concat(f(e.slice(0,i._path[0]+r)),[k(k({},l),{},{pId:"",_path:i._path})],f(e.slice(i._path[0]+r,e.length))),e=this.setChildrenPath("",[],e);else{var c=a[a.length-2];c.children=[].concat(f(c.children.slice(0,i._path[0]+r)),[k(k({},l),{},{pId:i.pId,_path:i._path})],f(c.children.slice(i._path[0]+r,c.children.length))),c.children=this.setChildrenPath(c.id,c._path,c.children)}e=w.removeNode(e,l)}}catch(e){}return e},setPath:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(e&&e instanceof Array&&e.length>0)for(var n=0;n<e.length;n++)e[n]._path=[].concat(f(t),[n]),e[n].children&&e[n].children.length>0&&w.setChildrenPath(e[n].pId,e[n]._path,e[n].children);return e},setChildrenPath:function(e,t,n){if(n&&n.length>0){for(var r=0;r<n.length;r++){try{n[r]._path=[].concat(f(t),[r])}catch(e){console.log("setChildrenPath",r,n,n[r])}n[r].pId=e,n[r].children&&n[r].children.length>0&&(n[r].children=w.setChildrenPath(n[r].id,[].concat(f(t),[r]),n[r].children))}return n}return[]},filter:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=[];if(t=t.trim())for(var r=0;r<e.length;r++){var o=null;if(((e[r].id+"").indexOf(t)>-1||(e[r].text+"").indexOf(t)>-1)&&((o=e[r]).open=!0),e[r].children&&e[r].children.length>0){var a=w.filter(e[r].children,t);a&&a.length>0&&((o=e[r]).open=!0,o.children=a)}o&&n.push(o)}return n},appendChildren:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;if(n){n._path||(n=w.findNodeById(e,n.id));var r=w.findLinkNodesByPath(e,n._path);if(r&&r.length>0){var o,a=r[r.length-1],l=null!==(o=a.children)&&void 0!==o?o:[];a.children=[].concat(l,t),a.children=w.setChildrenPath(a.id,a._path,a.children)}return e}return e=e.concat(t),w.setPath(e)},setVisibleDataProps:function(e,t){if(e.length>0){var n=[];return e.forEach((function(e){var r=w.findNodeByPath(t,e._path);n.push(k(k({},e),{},{checked:r.checked,open:r.open}))})),n}return[]}};const x=w;var O=l(313),C=l.n(O);const D={rowDefaultHeight:30,bufferScale:1},E=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=[];if(n&&n instanceof Array&&n.length>0)for(var o=0;o<n.length;o++)if((","+t+",").indexOf(","+(n[o].value+""||n[o].id+"")+",")>-1&&r.push(n[o].text),n[o].children&&n[o].children.length>0){var a=e(t,n[o].children);r=[].concat(a,r)}return r||[]};function I(e,r){var o=this,a=c((0,t.useState)(e.value),2),l=a[0],i=a[1],d=(0,t.useMemo)((function(){return E(l,e.data).join(",")}),[e.data,l]);(0,t.useEffect)((function(){var t;i((null!==(t=e.value)&&void 0!==t?t:"")+"")}),[e.value]),(0,t.useImperativeHandle)(r,(function(){return{setValue:function(e){i(e)},getValue:function(){return l}}}));var u=e.data,s=e.half,f=e.readOnly,h=(0,t.useCallback)((function(t,n,r,o,a){if(!e.readOnly)if(""!==t){var l=o.toString()||"",c=a||"";if(l=l?l.split(","):[],c=c?c.split(","):[],l.indexOf(t.toString())>-1)try{l.splice(l.indexOf(t.toString()),1),c.splice(c.indexOf(n.toString()),1)}catch(e){}else l.push(t+""),c.push(n+"");i(l.join(",")),e.onSelect&&e.onSelect(l.join(","),c.join(","),e.name,r)}else i(""),e.onSelect&&e.onSelect("","",e.name,r)}),[]);return u&&u instanceof Array&&u.length>0?n().createElement("div",{className:"wasabi-form-group "+(e.className||"")},n().createElement("div",{className:"wasabi-form-group-body"+(e.readOnly||e.disabled?" readOnly":"")},n().createElement("ul",{className:"wasabi-checkul radio"},u.map((function(e,t){var r,a,i=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=!1;return t&&(","+t.toString()+",").indexOf(","+e.value+",")>-1&&(n=!0),n}(e,l);return n().createElement("li",{key:t,onClick:h.bind(o,null!==(r=e.value)&&void 0!==r?r:"",null!==(a=e.text)&&void 0!==a?a:"",e,l,d)},n().createElement("label",{className:"checkbox-label "+(i?" checked ":" ")+(s?" halfcheck ":""),readOnly:f}),n().createElement("div",{className:"checktext "+(i?" checked":""),readOnly:f},e.text))}))))):null}const S=n().memo(n().forwardRef(I),(function(e,t){return!v.diff(e,t)}));function N(e,r){var o=this,a=c((0,t.useState)(e.value),2),l=a[0],i=a[1];(0,t.useEffect)((function(){i(e.value)}),[e.value]);var d=(0,t.useCallback)((function(t,n,r){i(t),e.onSelect&&e.onSelect(t,n,r)}),[]);(0,t.useImperativeHandle)(r,(function(){return{setValue:function(e){i(e)},getValue:function(){return l}}}));var u=e.data,s=e.readOnly;if(u&&u instanceof Array&&u.length>0){var f="wasabi-radio-btn "+(s?" readOnly":"");return n().createElement("div",{className:"wasabi-form-group "+(e.className||"")},n().createElement("div",{className:"wasabi-form-group-body"+(e.readOnly||e.disabled?" readOnly":"")},n().createElement("ul",{className:"wasabi-checkul radio"},u.map((function(e,t){var r,a;return n().createElement("li",{key:t},n().createElement("div",{className:f+((null!=l?l:"")+""==(null!==(r=e.value)&&void 0!==r?r:"")+""?" checkedRadio":""),onClick:d.bind(o,e.value,e.text,e)},n().createElement("i",null)),n().createElement("div",{className:"radiotext "+(s?" readOnly":"")+((null!=l?l:"")+""==(null!==(a=e.value)&&void 0!==a?a:"")+""?" checkedRadio":""),onClick:d.bind(o,e.value,e.text,e)},e.text))})))))}return null}const P=n().memo(n().forwardRef(N),(function(e,t){return!v.diff(e,t)}));function j(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function A(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function B(e,t,n){return t&&A(e.prototype,t),n&&A(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function R(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function T(e,t){return T=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},T(e,t)}function _(e,t){if(t&&("object"===h(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return R(e)}function F(e){return F=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},F(e)}const M=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&T(e,t)}(a,e);var t,r,o=(t=a,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=F(t);if(r){var o=F(this).constructor;e=Reflect.construct(n,arguments,o)}else e=n.apply(this,arguments);return _(this,e)});function a(e){var t;return j(this,a),(t=o.call(this,e)).state={oldPropsValue:null,value:t.props.value||""},t.onChange=t.onChange.bind(R(t)),t.keyUpHandler=t.keyUpHandler.bind(R(t)),t.blurHandler=t.blurHandler.bind(R(t)),t.getValue=t.getValue.bind(R(t)),t.setValue=t.setValue.bind(R(t)),t}return B(a,[{key:"getValue",value:function(){return this.state.value}},{key:"setValue",value:function(e){this.setState({value:e,show:!1})}},{key:"onChange",value:function(e){var t=e.target.value.toString();this.setValue(t),this.props.onChange&&this.props.onChange(t,t,this.props.name)}},{key:"keyUpHandler",value:function(e){this.props.onKeyUp&&this.props.onKeyUp(e)}},{key:"blurHandler",value:function(e){this.props.validate&&this.props.validate(this.state.value),this.props.onBlur&&this.props.onBlur(e.target.value,e.target.value,e)}},{key:"render",value:function(){return n().createElement(n().Fragment,null,n().createElement("div",{className:"wasabi-form-group "+(this.props.className||"")}," ",n().createElement("div",{className:"wasabi-form-group-body"+(this.props.readOnly||this.props.disabled?" readOnly":"")},n().createElement("input",{id:this.props.id,type:this.props.type,name:this.props.name,readOnly:this.props.readOnly,className:"wasabi-input ",onChange:this.onChange,onKeyUp:this.keyUpHandler,onBlur:this.blurHandler,value:this.state.value||"",autoComplete:"off"}),this.props.children)))}}],[{key:"getDerivedStateFromProps",value:function(e,t){return e.value!==t.oldPropsValue?{value:e.value||"",oldPropsValue:e.value}:null}}]),a}(t.Component);var H=B((function e(){j(this,e),this.isParent=null,this.id="",this.pId="",this.text="",this.title="",this.iconCls="",this.iconClose="",this.iconOpen="",this.open=!0,this.checked=!1,this.selectAble=!1,this.draggAble=!1,this.dropAble=!1,this.href=null,this.hide=!1,this.children=null,this.nodeid="",this.textid="",this.children=null,this._path=null,this.half=!1,this.isLast=!1}));function V(e){var t,r=function(e){var t=new H;for(var n in e){var r;"function"!=typeof e[n]&&(t[n]=null!==(r=e[n])&&void 0!==r?r:t[n])}return t}(e),o=e.clickId,a=e.loadingId,l=e.selectAble,i=e.checkStyle,c=e.renameAble,d=e.removeAble,u=e.rename,s=e.onDoubleClick,f=e.onClick,h=e.onChecked,p=e.onExpand,g=e.onNodeDragStart,y=e.onNodeDragEnd,v=e.onNodeDrop,b=e.onNodeDragOver,m=e.onNodeDragLeave,k=e.onBlur,w=e.onKeyUp,x=e.beforeNodeRename,O=e.beforeNodeRemove,C=r.title||r.text,E=r.iconCls;r.isParent&&(E=r.open?r.iconOpen?r.iconOpen:r.iconCls:r.iconClose?r.iconClose:r.iconCls),a===r.id&&(E="icon-loading tree-loading");var I,N,j=!1===r.open?0:(null==r||null===(t=r.children)||void 0===t?void 0:t.length)||0,A=20,B=[];if(r._path.length>1)for(var R=1;R<r._path.length;R++)B.push(n().createElement("span",{key:R,style:{width:20}})),A+=20;if(r.isParent){if(r.open?e.arrowUnFoldIcon&&(I=n().createElement("div",{className:"wasabi-tree-li-icon",style:{display:"inline-block"},onClick:r.isParent?p.bind(this,!r.open,r.id,r.text,e):null},e.arrowUnFoldIcon)):e.arrowFoldIcon&&(I=n().createElement("div",{className:"wasabi-tree-li-icon",style:{display:"inline-block"},onClick:r.isParent?p.bind(this,!r.open,r.id,r.text,e):null},e.arrowFoldIcon)),!I){var T="tree"===e.componentType?"icon-caret":"icon-arrow";I=n().createElement("i",{className:(o===r.id?" selected ":"")+(r.open?" wasabi-tree-li-icon  ".concat(T,"-down "):" wasabi-tree-li-icon  ".concat(T,"-right")),onClick:r.isParent?p.bind(this,!r.open,r.id,r.text,r):null},n().createElement("span",{className:"wasabi-tree-li-icon-beforeRight"}),n().createElement("span",{className:"wasabi-tree-li-icon-afterBelow",style:{height:(j+1)*D.rowDefaultHeight+(r.isLast?-1*D.rowDefaultHeight:0)}}))}}else I=n().createElement("i",{className:(o===r.id?" selected ":"")+" wasabi-tree-li-icon-line"},n().createElement("span",{className:"wasabi-tree-li-icon-afterBelow",style:{height:(j+1)*D.rowDefaultHeight+(r.isLast?-1*D.rowDefaultHeight:0)}}));return"checkbox"===i&&(l||r.selectAble)?N=n().createElement(S,{half:r.half,name:"node"+r.id,className:(o===r.id?" selected ":"")+(j>0?" hasChildren ":"  "),value:r.checked?r.id:"",data:[{value:r.id,text:""}],onSelect:h.bind(this,r.id,r.text,r)}):"radio"===i&&(l||r.selectAble)?N=n().createElement(P,{type:"radio",half:r.half,name:"node"+r.id,className:(o===r.id?" selected ":"")+(j>0?" hasChildren ":"  "),value:r.checked?r.id:"",data:[{value:r.id,text:""}],onSelect:h.bind(this,r.id,r.text,r)}):"function"==typeof i&&r.selectAble&&(N=i(r)),N&&(A+=20),n().createElement("li",{className:"wasabi-tree-li",key:r.id,style:{display:r.hide?"none":"flex"}},B,I,N,n().createElement("div",{id:r.nodeid,style:{width:"calc(100% - ".concat(A,"px)")},className:o===r.id?"wasabi-tree-li-node selected":"wasabi-tree-li-node",title:C,onDrop:v.bind(this,r.id,r.text,r),onDragOver:b.bind(this,r.id,r.text,r),onDragLeave:m.bind(this,r.id,r.text,r),onClick:f.bind(this,r.id,r.text,r),onDoubleClick:s.bind(this,r.id,r.text,r)},u?n().createElement(M,{id:r.textid,required:!0,onKeyUp:w.bind(this,r.id,r.text,r),onBlur:k.bind(this,r.id,r.text,r),name:"key"+r.id,value:r.text}):n().createElement("div",{key:"2",className:"wasabi-tree-li-node-text-div",draggable:r.draggAble,onDragEnd:y.bind(this,r.id,r.text,r),onDragStart:g.bind(this,r.id,r.text,r)},n().createElement("i",{key:"3",className:(!r.selectAble&&j?" noCheckhasChildren ":"  ")+E+" wasabi-tree-text-icon"}),n().createElement("a",{href:r.href,className:"wasabi-tree-txt"},r.text)),!u&&c?n().createElement("i",{key:"edit",className:"icon-edit edit",title:"重命名",onClick:x.bind(this,r.id,r.text,r)}):null,!u&&d?n().createElement("i",{key:"delete",className:"icon-delete edit",title:"删除",onClick:O.bind(this,r.id,r.text,r)}):null))}function L(r){var o=c((0,t.useState)(!1),2),a=o[0],l=o[1],i=c((0,t.useState)(v.uuid()),1)[0],d=c((0,t.useState)(v.uuid()),1)[0];(0,t.useEffect)((function(){if(a){var e=document.getElementById(i);e&&e.focus()}}),[a]);var u=(0,t.useCallback)((function(e,t,n,o){l(!1),r.onRename&&r.onRename(e,t,n,o)}),[]),s=(0,t.useCallback)((function(e,t,n){var o=!0;r.beforeRename&&(o=r.beforeRename(e,t,n)),l(o)}),[]),f=(0,t.useCallback)((function(e,t,n,r){u(e,t,n,r)}),[]),h=(0,t.useCallback)((function(e,t,n,r){13===r.keyCode&&u(e,t,n,r.target.value.trim())}),[]),p=(0,t.useCallback)((function(e,t,n){var o=!0;r.beforeRemove&&(o=r.beforeRemove(e,t,n)),o&&r.onRemove&&r.onRemove(e,t,n)}),[]),g=(0,t.useCallback)((function(e,t,n,o){if(n.draggAble){var a=!0;r.beforeDrag&&(a=r.beforeDrag(n)),a&&(o.dataTransfer.setData("drag",JSON.stringify(n)),window.localStorage.setItem("wasabi-drag-item",JSON.stringify(n)),r.onDrag&&r.onDrag(e,t,n))}}),[]),y=(0,t.useCallback)((function(e,t,n,r){r.preventDefault()}),[]),b=(0,t.useCallback)((function(e,t,n,r){if(r.preventDefault(),n.dropAble){var o=document.getElementById(d).getBoundingClientRect().top,a=r.clientY;a-o<10?(document.getElementById(d).style.borderTop="1px solid var(--border-color)",document.getElementById(d).style.borderBottom="none",document.getElementById(d).style.backgroundColor=null,window.localStorage.setItem("wasabi-drag-type","before")):a-o<30?(document.getElementById(d).style.borderTop="none",document.getElementById(d).style.borderBottom="none",document.getElementById(d).style.backgroundColor="var(--background-color)",window.localStorage.setItem("wasabi-drag-type","in")):(document.getElementById(d).style.borderTop="none",document.getElementById(d).style.borderBottom="1px solid var(--border-color)",document.getElementById(d).style.backgroundColor=null,window.localStorage.setItem("wasabi-drag-type","after"))}}),[]),m=(0,t.useCallback)((function(e,t,n,r){r.preventDefault(),document.getElementById(d).style.borderTop="none",document.getElementById(d).style.borderBottom="none",document.getElementById(d).style.backgroundColor=null}),[]),k=(0,t.useCallback)((function(e,t,n,o){o.preventDefault(),document.getElementById(d).style.borderTop="none",document.getElementById(d).style.borderBottom="none",document.getElementById(d).style.backgroundColor=null;var a=JSON.parse(o.dataTransfer.getData("drag")),l=window.localStorage.getItem("wasabi-drag-type");if(a&&n.dropAble){var i=!0;r.beforeDrop&&(i=r.beforeDrop(a,n,l)),i&&(window.localStorage.removeItem("wasabi-drag-type"),r.onDrop&&r.onDrop(a,n,l))}}),[]);return n().createElement(V,e({},r,{rename:a,textid:i,nodeid:d,onBlur:f,onKeyUp:h,beforeNodeRename:s,onNodeRename:u,beforeNodeRemove:p,onNodeDragEnd:y,onNodeDragLeave:m,onNodeDragOver:b,onNodeDragStart:g,onNodeDrop:k}))}V=n().memo(V),L.propTypes={isParent:s().bool,id:s().oneOfType([s().number,s().string]).isRequired,text:s().oneOfType([s().number,s().string]).isRequired,title:s().string,arrowFoldIcon:s().node,arrowUnFoldIcon:s().node,iconCls:s().string,iconClose:s().string,iconOpen:s().string,open:s().bool,checked:s().bool,selectAble:s().bool,draggAble:s().bool,dropAble:s().bool,href:s().string,hide:s().bool,children:s().array,onClick:s().func,onDoubleClick:s().func,onCheck:s().func,onCollapse:s().func,onExpand:s().func,onRename:s().func,onRemove:s().func,onRightClick:s().func,onDrag:s().func,onDrop:s().func,beforeDrag:s().func,beforeDrop:s().func,beforeRemove:s().func,beforeRename:s().func,beforeRightClick:s().func},L.defaultProps={iconCls:"icon-text",iconClose:"icon-folder",iconOpen:"icon-folder-open",checked:!1,selectAble:!1,open:!0,half:!1,draggAble:!1,dropAble:!1,children:[]};const U=n().memo(L);function Y(t){var r=[],o={componentType:t.componentType,selectAble:t.selectAble,checkStyle:t.checkStyle,renameAble:t.renameAble,removeAble:t.removeAble,asyncAble:t.asyncAble,clickId:t.clickId,loadingId:t.loadingId},a={beforeDrag:t.beforeDrag,beforeRemove:t.beforeRemove,beforeDrop:t.beforeDrop,beforeRename:t.beforeRename,onClick:t.onClick,onDoubleClick:t.onDoubleClick,onChecked:t.onChecked,onRemove:t.onRemove,onExpand:t.onExpand,onRename:t.onRename,onDrop:t.onDrop,onDrag:t.onDrag},l=t.visibleData;return l instanceof Array&&l.length>0&&l.map((function(t,l){var i=!1;(1==t.isParent||t.children instanceof Array&&t.children.length>0)&&(i=!0),r.push(n().createElement(U,e({key:"treenode-"+t.id||0},o,t,{isParent:i},a)))})),n().createElement("ul",{id:t.treeid,className:"wasabi-tree clearfix "+(!1===t.dotted?" nodotted ":"")},r)}const $=n().memo(Y);function q(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function K(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?q(Object(n),!0).forEach((function(t){d(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):q(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var J=function(e,t,n,r,o){var a=x.filter(t,n),l=v.treeDataToFlatData(n?a:t),i=l.slice(r,o),c=x.setVisibleDataProps(i,t);return K(K({},e),{},{filter:a,data:t,flatData:l,visibleData:c,sliceBeginIndex:r,sliceEndIndex:o,loadingId:null})},G=function(e,t,n,r){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,i={type:t||"post",contentType:n,url:e,headers:r||{},data:o,success:a,error:l},c=window.api||C();c.ajax(i),console.log("tree async-fetch",i)},z=function(e,t){try{var n=null,r=t.payload;switch(t.type){case"loading":return K(K({},e),{},{loadingId:r});case"onClick":case"onDoubleClick":return K(K({},e),{},{clickId:r});case"onChecked":var o=r.id+""==r.checkValue+"";return n=[],"checkbox"===r.checkStyle?n=x.setChecked(e.data,r.row,o,r.checkType):"radio"===r.checkStyle&&(n=x.setRadioChecked(e.data,r.row,o,r.radioType)),J(e,n,e.filterValue,e.sliceBeginIndex,e.sliceEndIndex);case"setChecked":if(r.id&&x.findNodeById(e.data,r.id))return"checkbox"===r.checkStyle?n=x.setChecked(e.data,r.node,!!r.checked,r.checkType):"radio"===r.checkStyle&&(n=x.setRadioChecked(e.data,r.node,!!r.checked,r.radioType)),J(e,n,e.filterValue,e.sliceBeginIndex,e.sliceEndIndex);case"clearChecked":return n=x.clearChecked(e.data),J(e,n,e.filterValue,e.sliceBeginIndex,sliceEndIndex);case"checkedAll":return n=x.checkedAll(e.data),J(e,n,e.filterValue,e.sliceBeginIndex,e.sliceEndIndex);case"onRename":return n=x.renameNode(e.data,r.row,r.newText),J(e,n,e.filterValue,e.sliceBeginIndex,e.sliceEndIndex);case"onRemove":return n=x.removeNode(e.data,r.row),J(e,n,e.filterValue,e.sliceBeginIndex,e.sliceEndIndex);case"onDrop":var l=r.dragNode,i=r.dropNode,c=r.dragType;if(l.id!==i.id)return n=null,"in"==c?l.pId!==i.id&&(n=x.moveInNode(e.data,l,i)):"before"==c?n=x.moveBeforeNode(e.data,l,i):"after"==c&&(n=x.moveAterNode(e.data,l,i)),n?J(e,n,e.filterValue,e.sliceBeginIndex,e.sliceEndIndex):e;case"showVisibleData":return J(e,r.data,r.filterValue,r.sliceBeginIndex,r.sliceEndIndex);case"setOpen":return n=x.setOpen(e.data,r.row,r.open),J(e,n,e.filterValue,e.sliceBeginIndex,e.sliceEndIndex);case"remove":return n=x.removeNode(e.data,a),J(e,n,e.filterValue,e.sliceBeginIndex,e.sliceEndIndex);case"append":var d=r.children,u=r.row;return n=x.appendChildren(e.data,d,u),J(e,n,e.filterValue,e.sliceBeginIndex,e.sliceEndIndex);case"filter":return J(e,e.data,r,e.sliceBeginIndex,e.sliceEndIndex);default:return e}}catch(e){console.log("reduce error",e)}};function Q(r,o){var a=c((0,t.useState)(v.uuid()),1)[0],l=(0,t.useState)(v.uuid()),i=(0,t.useRef)(null),d=(0,t.useRef)(null),u=c((0,t.useReducer)(z,{filter:null,data:null,flatData:null,visibleData:null,sliceBeginIndex:0,sliceEndIndex:0,loadingId:null,clickId:null}),2),s=u[0],f=u[1],h=(0,t.useCallback)((function(e,t,n){var o,a,l,c;f({type:"onClick",payload:e}),null==d||null===(o=d.current)||void 0===o||null===(a=o.grid)||void 0===a||a.current.setFocus(e),null==i||null===(l=i.current)||void 0===l||null===(c=l.grid)||void 0===c||c.current.setFocus(e),r.onClick&&r.onClick(e,t,n)}),[s.clickId]),p=(0,t.useCallback)((function(e,t,n){f({type:"onDoubleClick",payload:e}),r.onDoubleClick&&r.onDoubleClick(e,t,n)}),[]),g=(0,t.useCallback)((function(e,t,n,o){f({type:"onChecked",payload:{id:e,text:t,row:n,checkValue:o,checkType:r.checkType,checkStyle:r.checkStyle,radioType:r.radioType}});var a=e+""==o+"";r.onChecked&&r.onChecked(a,e,t,n)}),[]),y=(0,t.useCallback)((function(e,t,n){window.confirm("您确定删除【"+t+"]吗")&&(f({type:"onRemove",payload:{id:e,text:t,row:n}}),r.onRemove&&r.onRemove(e,t,n))}),[]),m=(0,t.useCallback)((function(e,t,n,o){f({type:"onRename",payload:{id:e,text:t,row:n,newText:o}}),r.onRename&&r.onRename(e,t,n,o)}),[]),k=(0,t.useCallback)((function(e,t,n){f({type:"onDrop",payload:{dragNode:e,dropNode:t,dragType:n}})}),[]),w=(0,t.useCallback)((function(e){if(f({type:"loading",payload:null}),"function"==typeof r.loadSuccess){var t=r.loadSuccess(e);e=t&&t instanceof Array?t:e}var n=v.getSource(e,r.dataSource||"data"),o=window.sessionStorage.getItem("async-tree-node");o=JSON.parse(o);var a=b("tree","",n,r.idField||"id",r.textField||"text",r.parentField||"pId",r.simpleData);f({type:"append",payload:{children:a,row:o}})}),[]),O=(0,t.useCallback)((function(){f({type:"loading",payload:null})}),[]),C=(0,t.useCallback)((function(e,t,n,o){if(f({type:"setOpen",payload:{row:o,open:e}}),r.asyncAble&&(!o.children||0==o.children.length)){var a=[];if(r.onAsync&&"function"==typeof r.onAsync)(a=r.onAsync(t,n,o))&&a instanceof Array&&a.length>0&&(a=b("tree","",a,r.idField||"id",r.textField||"text",r.parentField||"pId",r.simpleData),f({type:"append",payload:{children:a,row:o}}));else if(r.url){f({type:"loading",payload:t}),window.sessionStorage.setItem("async-tree-node",JSON.stringify(o));var l=v.clone(r.params)||{};l[r.idField||"id"]=t,G(r.url,r.httpType,r.contentType,r.headers,l,w,O)}}r.onExpand&&r.onExpand(e,t,n,o)}),[r.url,r.httpType,r.contentType,r.params,r.headers,r.idField]),E=(0,t.useCallback)((function(e){var t=document.getElementById(a).clientHeight||window.innerHeight,n=Math.ceil(t/D.rowDefaultHeight),r=document.getElementById(a).scrollTop,o=Math.floor(r/D.rowDefaultHeight);I(o,o+D.bufferScale*n,n,e)}),[]),I=(0,t.useCallback)((function(e,t,n){var r,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(e>=1){var a=(e+1)*D.rowDefaultHeight-(e-D.bufferScale*n>=0?(e-D.bufferScale*n)*D.rowDefaultHeight:0);r=e*D.rowDefaultHeight-a}else r=0;document.getElementById(l).style.transform="translate3d(0,".concat(r,"px,0)");var i=e-D.bufferScale*n,c=t+D.bufferScale*n;f({type:"showVisibleData",payload:{sliceBeginIndex:i=i<0?0:i,sliceEndIndex:c,filterValue:s.filterValue,data:o}})}),[s.filterValue]);(0,t.useImperativeHandle)(o,(function(){return{getChecked:function(){return x.getChecked(s.data)},setChecked:function(e,t){null!=e&&""!==e&&f({type:"setChecked",payload:{id:e,checked:t,checkType:r.checkType,checkStyle:r.checkStyle,radioType:r.radioType}})},clearChecked:function(){f({type:"clearChecked"})},checkedAll:function(){f({type:"checkedAll"})},setClick:function(e){var t,n,r,o;f({type:"setClick",payload:e}),null==d||null===(t=d.current)||void 0===t||null===(n=t.grid)||void 0===n||n.current.setFocus(e),null==i||null===(r=i.current)||void 0===r||null===(o=r.grid)||void 0===o||o.current.setFocus(e),onscroll()},setOpen:function(e,t){f({type:"setOpen",payload:{id:e,open:t}})},remove:function(e){f({type:"remove",payload:e})},filter:function(e){f({type:"filter",payload:e})},append:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;e&&e.length>0&&f({type:"append",payload:{children:e,row:t}})},adjust:function(){onscroll()}}})),(0,t.useEffect)((function(){if(r.url)E([]),G(r.url,r.httpType,r.contentType,r.headers,r.params,w,O);else{var e=document.getElementById(a).clientHeight||window.innerHeight,t=Math.ceil(e/D.rowDefaultHeight),n=document.getElementById(a).scrollTop,o=Math.floor(n/D.rowDefaultHeight),l=o+D.bufferScale*t,i=b("tree",null,r.data,r.idField,r.textField,r.parentField,r.simpleData);I(o,l||D.visibleCount,t||D.visibleCount,i||[])}}),[r.url,r.data]);var S,N={beforeDrag:r.beforeDrag,beforeRemove:r.beforeRemove,beforeDrop:r.beforeDrop,beforeRename:r.beforeRename,onDrag:r.onDrag,onClick:h,onDoubleClick:p,onChecked:g,onRemove:y,onExpand:C,onRename:m,onDrop:k};return r.componentType&&"tree"!==r.componentType?"treegrid"===r.componentType&&(S=n().createElement(TreeGridView,e({ref:i},this.props,s,N,{treeid:l}))):S=n().createElement($,e({},r,s,N,{treeid:l})),n().createElement("div",{id:a,onScroll:E.bind(this,s.data),className:"wasabi-tree-parent "+(r.className||""),style:r.style},S,n().createElement("div",{style:{left:0,top:0,height:s.flatData&&s.flatData.length*D.rowDefaultHeight,position:"absolute",width:1}}))}(Q=n().forwardRef(Q)).propTypes={componentType:s().oneOf(["tree","treegrid"]),name:s().string,idField:s().string,parentField:s().string,textField:s().string,dotted:s().bool,url:s().string,params:s().object,dataSource:s().string,headers:s().array,data:s().array,simpleData:s().bool,selectAble:s().bool,checkStyle:s().oneOf(["checkbox","radio",s().func]),checkType:s().object,radioType:s().oneOf(["level","all"]),renameAble:s().bool,removeAble:s().bool,asyncAble:s().bool,onClick:s().func,onDoubleClick:s().func,onCheck:s().func,onExpand:s().func,onRename:s().func,onRemove:s().func,onRightClick:s().func,onDrag:s().func,onDrop:s().func,onAsync:s().func,beforeDrag:s().func,beforeDrop:s().func,beforeRemove:s().func,beforeRename:s().func,beforeRightClick:s().func},Q.defaultProps={componentType:"tree",idField:"id",parentField:"pId",textField:"text",dataSource:"data",dotted:!0,simpleData:!0,selectAble:!0,checkStyle:"checkbox",checkType:{y:"ps",n:"ps"},radioType:"all"};const W=n().memo(Q);function Z(t,r){return n().createElement(W,e({},t,{ref:r,componentType:"tree"}))}const X=n().memo(n().forwardRef(Z),(function(e,t){return!func.diff(e,t,!1)}))})(),i})()}));